<html>
<head>
    <title>My Web Page</title>  
    <style>
     html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
}

canvas {
    display: block;      /* removes inline-canvas whitespace */
    width: 100vw;
    height: 100vh;
}
    </style>
</head>
<body>
    <canvas id="myCanvas" width="1200" height="800" style="border:1px solid #000000;"></canvas>
     <script defer>

const text = 'Hello, This is old school scrolling text using texture atlas! 0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz';

const fnt_source = `char id=32 x=0 y=0 width=0 height=0 xoffset=0 yoffset=0 xadvance=21 page=0 chnl=15
char id=33 x=419 y=289 width=14 height=56 xoffset=4 yoffset=3 xadvance=21 page=0 chnl=15
char id=34 x=391 y=305 width=24 height=22 xoffset=2 yoffset=3 xadvance=26 page=0 chnl=15
char id=35 x=178 y=228 width=44 height=58 xoffset=-1 yoffset=2 xadvance=41 page=0 chnl=15
char id=36 x=266 y=254 width=39 height=66 xoffset=1 yoffset=0 xadvance=41 page=0 chnl=15
char id=37 x=0 y=187 width=61 height=58 xoffset=2 yoffset=2 xadvance=65 page=0 chnl=15
char id=38 x=128 y=57 width=49 height=58 xoffset=1 yoffset=2 xadvance=49 page=0 chnl=15
char id=39 x=442 y=0 width=13 height=22 xoffset=1 yoffset=3 xadvance=14 page=0 chnl=15
char id=40 x=419 y=0 width=22 height=72 xoffset=3 yoffset=2 xadvance=24 page=0 chnl=15
char id=41 x=419 y=73 width=22 height=72 xoffset=3 yoffset=2 xadvance=24 page=0 chnl=15
char id=42 x=141 y=414 width=28 height=26 xoffset=1 yoffset=2 xadvance=29 page=0 chnl=15
char id=43 x=266 y=188 width=40 height=38 xoffset=2 yoffset=13 xadvance=43 page=0 chnl=15
char id=44 x=442 y=23 width=13 height=21 xoffset=4 yoffset=48 xadvance=21 page=0 chnl=15
char id=45 x=266 y=437 width=24 height=10 xoffset=1 yoffset=33 xadvance=24 page=0 chnl=15
char id=46 x=141 y=441 width=13 height=11 xoffset=5 yoffset=48 xadvance=21 page=0 chnl=15
char id=47 x=352 y=393 width=26 height=58 xoffset=-2 yoffset=2 xadvance=21 page=0 chnl=15
char id=48 x=266 y=321 width=39 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=49 x=391 y=248 width=25 height=56 xoffset=6 yoffset=3 xadvance=41 page=0 chnl=15
char id=50 x=225 y=289 width=40 height=56 xoffset=0 yoffset=3 xadvance=41 page=0 chnl=15
char id=51 x=225 y=57 width=40 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=52 x=229 y=0 width=41 height=56 xoffset=-1 yoffset=3 xadvance=41 page=0 chnl=15
char id=53 x=225 y=346 width=40 height=56 xoffset=1 yoffset=4 xadvance=41 page=0 chnl=15
char id=54 x=266 y=379 width=39 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=55 x=312 y=58 width=39 height=55 xoffset=2 yoffset=4 xadvance=41 page=0 chnl=15
char id=56 x=225 y=115 width=40 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=57 x=225 y=173 width=40 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=58 x=128 y=414 width=12 height=41 xoffset=5 yoffset=18 xadvance=21 page=0 chnl=15
char id=59 x=73 y=403 width=13 height=51 xoffset=4 yoffset=18 xadvance=21 page=0 chnl=15
char id=61 x=266 y=227 width=40 height=26 xoffset=2 yoffset=19 xadvance=43 page=0 chnl=15
char id=63 x=312 y=0 width=39 height=57 xoffset=1 yoffset=2 xadvance=41 page=0 chnl=15
char id=64 x=0 y=57 width=72 height=72 xoffset=2 yoffset=2 xadvance=74 page=0 chnl=15
char id=65 x=75 y=0 width=54 height=56 xoffset=-2 yoffset=3 xadvance=49 page=0 chnl=15
char id=66 x=178 y=287 width=44 height=56 xoffset=4 yoffset=3 xadvance=49 page=0 chnl=15
char id=67 x=73 y=344 width=51 height=58 xoffset=2 yoffset=2 xadvance=52 page=0 chnl=15
char id=68 x=128 y=116 width=48 height=56 xoffset=4 yoffset=3 xadvance=52 page=0 chnl=15
char id=69 x=178 y=344 width=44 height=56 xoffset=4 yoffset=3 xadvance=49 page=0 chnl=15
char id=70 x=271 y=0 width=40 height=56 xoffset=4 yoffset=3 xadvance=44 page=0 chnl=15
char id=71 x=73 y=114 width=53 height=58 xoffset=2 yoffset=2 xadvance=57 page=0 chnl=15
char id=72 x=128 y=357 width=46 height=56 xoffset=4 yoffset=3 xadvance=52 page=0 chnl=15
char id=73 x=442 y=159 width=12 height=56 xoffset=5 yoffset=3 xadvance=21 page=0 chnl=15
char id=74 x=352 y=335 width=34 height=57 xoffset=0 yoffset=3 xadvance=36 page=0 chnl=15
char id=75 x=128 y=173 width=48 height=56 xoffset=4 yoffset=3 xadvance=49 page=0 chnl=15
char id=76 x=352 y=43 width=37 height=56 xoffset=4 yoffset=3 xadvance=41 page=0 chnl=15
char id=77 x=73 y=57 width=54 height=56 xoffset=4 yoffset=3 xadvance=60 page=0 chnl=15
char id=78 x=182 y=0 width=46 height=56 xoffset=4 yoffset=3 xadvance=52 page=0 chnl=15
char id=79 x=0 y=395 width=55 height=58 xoffset=2 yoffset=2 xadvance=57 page=0 chnl=15
char id=80 x=178 y=171 width=45 height=56 xoffset=4 yoffset=3 xadvance=49 page=0 chnl=15
char id=81 x=0 y=246 width=56 height=61 xoffset=1 yoffset=2 xadvance=57 page=0 chnl=15
char id=82 x=130 y=0 width=51 height=56 xoffset=4 yoffset=3 xadvance=52 page=0 chnl=15
char id=83 x=128 y=240 width=47 height=58 xoffset=1 yoffset=2 xadvance=49 page=0 chnl=15
char id=84 x=178 y=57 width=46 height=56 xoffset=0 yoffset=3 xadvance=44 page=0 chnl=15
char id=85 x=128 y=299 width=46 height=57 xoffset=4 yoffset=3 xadvance=52 page=0 chnl=15
char id=86 x=73 y=173 width=52 height=56 xoffset=-1 yoffset=3 xadvance=49 page=0 chnl=15
char id=87 x=0 y=130 width=72 height=56 xoffset=-1 yoffset=3 xadvance=68 page=0 chnl=15
char id=88 x=73 y=230 width=52 height=56 xoffset=-1 yoffset=3 xadvance=49 page=0 chnl=15
char id=89 x=73 y=287 width=52 height=56 xoffset=-1 yoffset=3 xadvance=49 page=0 chnl=15
char id=90 x=178 y=114 width=46 height=56 xoffset=0 yoffset=3 xadvance=44 page=0 chnl=15
char id=91 x=391 y=385 width=20 height=70 xoffset=3 yoffset=3 xadvance=21 page=0 chnl=15
char id=93 x=419 y=218 width=19 height=70 xoffset=0 yoffset=3 xadvance=21 page=0 chnl=15
char id=94 x=352 y=302 width=36 height=32 xoffset=0 yoffset=2 xadvance=34 page=0 chnl=15
char id=95 x=128 y=230 width=48 height=9 xoffset=-3 yoffset=65 xadvance=41 page=0 chnl=15
char id=97 x=178 y=401 width=40 height=44 xoffset=1 yoffset=16 xadvance=41 page=0 chnl=15
char id=98 x=312 y=173 width=38 height=57 xoffset=3 yoffset=3 xadvance=41 page=0 chnl=15
char id=99 x=312 y=405 width=38 height=44 xoffset=1 yoffset=16 xadvance=36 page=0 chnl=15
char id=100 x=312 y=231 width=38 height=57 xoffset=1 yoffset=3 xadvance=41 page=0 chnl=15
char id=101 x=225 y=403 width=40 height=44 xoffset=1 yoffset=16 xadvance=41 page=0 chnl=15
char id=102 x=391 y=0 width=27 height=57 xoffset=-1 yoffset=2 xadvance=21 page=0 chnl=15
char id=103 x=312 y=114 width=38 height=58 xoffset=1 yoffset=16 xadvance=41 page=0 chnl=15
char id=104 x=352 y=100 width=36 height=56 xoffset=3 yoffset=3 xadvance=41 page=0 chnl=15
char id=105 x=442 y=45 width=12 height=56 xoffset=3 yoffset=3 xadvance=16 page=0 chnl=15
char id=106 x=419 y=146 width=20 height=71 xoffset=-5 yoffset=3 xadvance=16 page=0 chnl=15
char id=107 x=352 y=157 width=36 height=56 xoffset=3 yoffset=3 xadvance=36 page=0 chnl=15
char id=108 x=442 y=102 width=12 height=56 xoffset=3 yoffset=3 xadvance=16 page=0 chnl=15
char id=109 x=0 y=308 width=56 height=43 xoffset=3 yoffset=16 xadvance=60 page=0 chnl=15
char id=110 x=352 y=214 width=36 height=43 xoffset=3 yoffset=16 xadvance=41 page=0 chnl=15
char id=111 x=266 y=57 width=40 height=44 xoffset=1 yoffset=16 xadvance=41 page=0 chnl=15
char id=112 x=312 y=289 width=38 height=57 xoffset=3 yoffset=16 xadvance=41 page=0 chnl=15
char id=113 x=312 y=347 width=38 height=57 xoffset=1 yoffset=16 xadvance=41 page=0 chnl=15
char id=114 x=391 y=204 width=26 height=43 xoffset=3 yoffset=16 xadvance=24 page=0 chnl=15
char id=115 x=87 y=403 width=37 height=44 xoffset=0 yoffset=16 xadvance=36 page=0 chnl=15
char id=116 x=391 y=328 width=23 height=56 xoffset=0 yoffset=4 xadvance=21 page=0 chnl=15
char id=117 x=352 y=258 width=36 height=43 xoffset=3 yoffset=17 xadvance=41 page=0 chnl=15
char id=118 x=266 y=102 width=40 height=42 xoffset=-1 yoffset=17 xadvance=36 page=0 chnl=15
char id=119 x=0 y=352 width=56 height=42 xoffset=-1 yoffset=17 xadvance=52 page=0 chnl=15
char id=120 x=266 y=145 width=40 height=42 xoffset=-1 yoffset=17 xadvance=36 page=0 chnl=15
char id=121 x=225 y=231 width=40 height=57 xoffset=-1 yoffset=17 xadvance=36 page=0 chnl=15
char id=122 x=352 y=0 width=38 height=42 xoffset=0 yoffset=17 xadvance=36 page=0 chnl=15
char id=123 x=391 y=58 width=26 height=72 xoffset=0 yoffset=2 xadvance=25 page=0 chnl=15
char id=124 x=442 y=216 width=11 height=72 xoffset=5 yoffset=2 xadvance=19 page=0 chnl=15
char id=125 x=391 y=131 width=26 height=72 xoffset=0 yoffset=2 xadvance=25 page=0 chnl=15
char id=8470 x=0 y=0 width=74 height=56 xoffset=4 yoffset=3 xadvance=78 page=0 chnl=15
`


const canvas = document.getElementById("myCanvas");
const gl = canvas.getContext("webgl2");
if (!gl) throw new Error("WebGL2 required");

// ================== SHADERS ==================
const vsSource = `#version 300 es
precision mediump float;

in vec2 a_position;
in vec2 a_texcoord;

in vec2 a_offset;
in vec2 a_size;
in vec4 a_uvRect;   // (uMin, vMin, uSize, vSize)

uniform vec2 u_resolution;

out vec2 v_texcoord;

void main() {
    vec2 pos = a_position * a_size + a_offset;

    vec2 clip = (pos / u_resolution) * 2.0 - 1.0;
    float depth = 1.0 + sin(clip.x*16.0) * 0.05;
    gl_Position = vec4(clip * vec2(1, -1), 0.0, depth);

    // ðŸ”‘ atlas mapping
    v_texcoord = a_uvRect.xy + a_texcoord * a_uvRect.zw;
}
`;

const fsSource = `#version 300 es
precision mediump float;

in vec2 v_texcoord;
uniform sampler2D u_texture;
uniform vec2 u_resolution;

out vec4 outColor;

void main() {
    vec4 texColor = texture(u_texture, v_texcoord);

    // screen-space Y (0..1, bottom -> top)
    float screenY = sin(gl_FragCoord.y / u_resolution.y * 40.0) * 0.5 + 0.5;

    vec3 gradient = mix(
        vec3(1.0, 0.0, 0.0),
        vec3(0.0, 0.0, 1.0),
        screenY
    );

    float check = mod(gl_FragCoord.y / u_resolution.y * 400.0, 4.0);

    if (check < 0.3) {
        outColor = vec4(0.0);
    } else {
        outColor = vec4(texColor.rgb * gradient, texColor.a);
    }
}
`;

// ================== UTILS ==================
function createShader(gl, type, src) {
    const s = gl.createShader(type);
    gl.shaderSource(s, src);
    gl.compileShader(s);
    if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
        throw new Error(gl.getShaderInfoLog(s));
    }
    return s;
}

function createProgram(gl, vs, fs) {
    const p = gl.createProgram();
    gl.attachShader(p, vs);
    gl.attachShader(p, fs);
    gl.linkProgram(p);
    if (!gl.getProgramParameter(p, gl.LINK_STATUS)) {
        throw new Error(gl.getProgramInfoLog(p));
    }
    return p;
}

function create_atlas_from_fnt(fnt) {
    const atlas = new Map();
    const lines = fnt.split('\n');
    for (const line of lines) {
        if (line.startsWith('char ')) {
            const parts = line.split(' ');
            const charData = {};
            for (const part of parts) {
                const [key, value] = part.split('=');
                if (key && value) {
                    charData[key] = value;
                }
            }
            const id = parseInt(charData['id']);
            atlas.set(id, {
                x: parseInt(charData['x']),
                y: parseInt(charData['y']),
                width: parseInt(charData['width']),
                height: parseInt(charData['height']),
                xoffset: parseInt(charData['xoffset']),
                yoffset: parseInt(charData['yoffset']),
                xadvance: parseInt(charData['xadvance'])
            });
        }
    }
    return atlas;
}

const atlas = create_atlas_from_fnt(fnt_source);

// ================== PROGRAM ==================
const program = createProgram(
    gl,
    createShader(gl, gl.VERTEX_SHADER, vsSource),
    createShader(gl, gl.FRAGMENT_SHADER, fsSource)
);
gl.useProgram(program);

// ================== GEOMETRY ==================
const quadVertices = new Float32Array([
    0, 0,
    1, 0,
    0, 1,
    0, 1,
    1, 0,
    1, 1
]);

const texCoords = new Float32Array([
    0, 0,
    1, 0,
    0, 1,
    0, 1,
    1, 0,
    1, 1
]);

const quadBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, quadBuffer);
gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);

const texBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, texBuffer);
gl.bufferData(gl.ARRAY_BUFFER, texCoords, gl.STATIC_DRAW);

// ================== INSTANCE DATA ==================
const maxRects = text.length;

const instancePositions = new Float32Array(maxRects * 2);
const instanceSizes = new Float32Array(maxRects * 2);
const velocities = new Float32Array(maxRects * 2);
const uvRects = new Float32Array(maxRects * 4);

const offsetBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, offsetBuffer);
gl.bufferData(gl.ARRAY_BUFFER, instancePositions, gl.DYNAMIC_DRAW);

const sizeBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sizeBuffer);
gl.bufferData(gl.ARRAY_BUFFER, instanceSizes, gl.DYNAMIC_DRAW);

const uvBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, uvBuffer);
gl.bufferData(gl.ARRAY_BUFFER, uvRects, gl.DYNAMIC_DRAW);

// ================== VAO ==================
const vao = gl.createVertexArray();
gl.bindVertexArray(vao);

// position
gl.bindBuffer(gl.ARRAY_BUFFER, quadBuffer);
const aPosLoc = gl.getAttribLocation(program, "a_position");
gl.enableVertexAttribArray(aPosLoc);
gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);

// texcoord
gl.bindBuffer(gl.ARRAY_BUFFER, texBuffer);
const aTexLoc = gl.getAttribLocation(program, "a_texcoord");
gl.enableVertexAttribArray(aTexLoc);
gl.vertexAttribPointer(aTexLoc, 2, gl.FLOAT, false, 0, 0);

// offset
gl.bindBuffer(gl.ARRAY_BUFFER, offsetBuffer);
const aOffsetLoc = gl.getAttribLocation(program, "a_offset");
gl.enableVertexAttribArray(aOffsetLoc);
gl.vertexAttribPointer(aOffsetLoc, 2, gl.FLOAT, false, 0, 0);
gl.vertexAttribDivisor(aOffsetLoc, 1);

// size
gl.bindBuffer(gl.ARRAY_BUFFER, sizeBuffer);
const aSizeLoc = gl.getAttribLocation(program, "a_size");
gl.enableVertexAttribArray(aSizeLoc);
gl.vertexAttribPointer(aSizeLoc, 2, gl.FLOAT, false, 0, 0);
gl.vertexAttribDivisor(aSizeLoc, 1);

// uvRect
gl.bindBuffer(gl.ARRAY_BUFFER, uvBuffer);
const aUvRectLoc = gl.getAttribLocation(program, "a_uvRect");
gl.enableVertexAttribArray(aUvRectLoc);
gl.vertexAttribPointer(aUvRectLoc, 4, gl.FLOAT, false, 0, 0);
gl.vertexAttribDivisor(aUvRectLoc, 1);

gl.bindVertexArray(null);

// ================== UNIFORMS ==================
const uResLoc = gl.getUniformLocation(program, "u_resolution");
gl.uniform2f(uResLoc, canvas.width, canvas.height);

const uTexLoc = gl.getUniformLocation(program, "u_texture");
gl.uniform1i(uTexLoc, 0);

const atlasWidth = 455;
const atlasHeight = 455;

let posx = 0.0;
// ================== INIT DATA ==================
for (let i = 0; i < maxRects; i++) {
    const char = text.charCodeAt(i);
    const glyph = atlas.get(char);
    instancePositions[i * 2] = canvas.width + posx;
    instancePositions[i * 2 + 1] = canvas.height / 2 + glyph.yoffset;
    instanceSizes[i * 2] = glyph.width;
    instanceSizes[i * 2 + 1] = glyph.height;
    posx += glyph.xadvance;
    uvRects[i * 4] = glyph.x / atlasWidth;
    uvRects[i * 4 + 1] = glyph.y / atlasHeight;
    uvRects[i * 4 + 2] = glyph.width / atlasWidth;
    uvRects[i * 4 + 3] = glyph.height / atlasHeight;

    velocities[i * 2] = (Math.random() - 0.5);
    velocities[i * 2 + 1] = (Math.random() - 0.5);
}

gl.bindBuffer(gl.ARRAY_BUFFER, offsetBuffer);
gl.bufferSubData(gl.ARRAY_BUFFER, 0, instancePositions);

gl.bindBuffer(gl.ARRAY_BUFFER, sizeBuffer);
gl.bufferSubData(gl.ARRAY_BUFFER, 0, instanceSizes);

gl.bindBuffer(gl.ARRAY_BUFFER, uvBuffer);
gl.bufferSubData(gl.ARRAY_BUFFER, 0, uvRects);

// ================== TEXTURE ==================
const texture = gl.createTexture();
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);

gl.texImage2D(
    gl.TEXTURE_2D,
    0,
    gl.RGBA,
    1,
    1,
    0,
    gl.RGBA,
    gl.UNSIGNED_BYTE,
    new Uint8Array([255, 0, 0, 255])
);

gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

const img = new Image();
img.src = "font.png";
img.onload = () => {
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, texture);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
    requestAnimationFrame(render);
};

// ================== RENDER ==================
gl.enable(gl.BLEND);
gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

let mx = -3.0;
function render(time) {
    gl.clearColor(0, 0, 0, 1);
    gl.clear(gl.COLOR_BUFFER_BIT);


    for (let i = 0; i < maxRects; i++) {
        const char = text.charCodeAt(i);
        const glyph = atlas.get(char);
        instancePositions[i * 2] += mx;
        instancePositions[i * 2 + 1] = canvas.height / 2 + glyph.yoffset + Math.abs(Math.sin(time * 0.005)) * 20.0;
    }
    if (instancePositions[(maxRects-1)*2]<-30.0) {
        let posx = 0.0;
        for (let i = 0; i < maxRects; i++) {
            const char = text.charCodeAt(i);
            const glyph = atlas.get(char);
            instancePositions[i * 2] = canvas.width + posx;
            posx += glyph.xadvance;
        }
    }

    gl.bindBuffer(gl.ARRAY_BUFFER, offsetBuffer);
    gl.bufferSubData(gl.ARRAY_BUFFER, 0, instancePositions);

    gl.useProgram(program);
    gl.bindVertexArray(vao);
    gl.drawArraysInstanced(gl.TRIANGLES, 0, 6, maxRects);

    requestAnimationFrame(render);
}


    </script>
</body>
</html>